<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>blackNote - AI Chat</title>
  <link rel="icon" type="image/png" href="/assets/BN.png" id="favicon">
  <link rel="stylesheet" href="/css/blacknote.css">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
    }

    /* Main AI Container */
    .ai-main-container {
      display: flex;
      height: calc(100vh - 65px);
      position: relative;
    }

    /* Notes Panel */
    .notes-panel {
      width: 380px;
      min-width: 280px;
      max-width: 600px;
      background: linear-gradient(180deg, rgba(15, 32, 39, 0.95) 0%, rgba(32, 58, 67, 0.95) 100%);
      border-left: 1px solid rgba(100, 200, 255, 0.2);
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
      box-shadow: -4px 0 30px rgba(0, 168, 232, 0.1);
      order: 2;
      position: relative;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateX(0);
    }

    .notes-panel.closed {
      transform: translateX(100%);
    }

    /* Resize Handle */
    .resize-handle {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 8px;
      cursor: ew-resize;
      background: transparent;
      z-index: 10;
      transition: background 0.3s ease;
    }

    .resize-handle:hover,
    .resize-handle.resizing {
      background: linear-gradient(90deg, rgba(0, 168, 232, 0.3) 0%, rgba(0, 168, 232, 0.6) 100%);
    }

    .resize-handle::before {
      content: '';
      position: absolute;
      left: 2px;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 40px;
      background: linear-gradient(180deg, #00A8E8 0%, #667eea 100%);
      border-radius: 4px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .resize-handle:hover::before,
    .resize-handle.resizing::before {
      opacity: 1;
    }

    /* Toggle Button */
    .notes-toggle-btn {
      position: fixed;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #00A8E8 0%, #667eea 100%);
      color: white;
      border: none;
      padding: 20px 12px;
      border-radius: 12px 0 0 12px;
      cursor: pointer;
      font-size: 20px;
      font-weight: 700;
      z-index: 100;
      box-shadow: -4px 0 20px rgba(0, 168, 232, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      writing-mode: vertical-rl;
      text-orientation: mixed;
    }

    .notes-toggle-btn:hover {
      padding-right: 16px;
      box-shadow: -8px 0 30px rgba(0, 168, 232, 0.6);
    }

    .notes-panel:not(.closed) ~ .notes-toggle-btn {
      display: none;
    }

    /* Notes Header */
    .notes-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(100, 200, 255, 0.2);
      background: linear-gradient(135deg, rgba(0, 168, 232, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .notes-header-content {
      flex: 1;
    }

    .notes-header h3 {
      margin: 0 0 0.5rem 0;
      color: #64C8FF;
      font-size: 18px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(100, 200, 255, 0.3);
    }

    .notes-header p {
      margin: 0;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
    }

    .notes-close-btn {
      background: rgba(255, 82, 82, 0.15);
      color: #ff6b9d;
      border: 1px solid rgba(255, 82, 82, 0.3);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 700;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .notes-close-btn:hover {
      background: rgba(255, 82, 82, 0.25);
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(255, 82, 82, 0.3);
    }

    /* Notepad Editor */
    .notepad-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      overflow: hidden;
    }

    .notepad-editor {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(100, 200, 255, 0.3);
      border-radius: 12px;
      padding: 16px;
      color: rgba(255, 255, 255, 0.95);
      font-size: 14px;
      resize: none;
      font-family: 'Courier New', monospace;
      line-height: 1.6;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .notepad-editor:focus {
      outline: none;
      border-color: #00A8E8;
      box-shadow: 0 0 0 3px rgba(0, 168, 232, 0.2);
      background: rgba(0, 0, 0, 0.4);
    }

    .notepad-editor::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .notepad-editor::-webkit-scrollbar {
      width: 8px;
    }

    .notepad-editor::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .notepad-editor::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #00A8E8 0%, #667eea 100%);
      border-radius: 10px;
    }

    .notepad-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .notepad-btn {
      background: rgba(0, 168, 232, 0.2);
      border: 1px solid rgba(100, 200, 255, 0.3);
      color: #64C8FF;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .notepad-btn:hover {
      background: rgba(0, 168, 232, 0.4);
      border-color: #64C8FF;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 168, 232, 0.3);
    }

    .notepad-btn.clear {
      background: rgba(255, 82, 82, 0.15);
      color: #ff6b9d;
      border-color: rgba(255, 82, 82, 0.3);
    }

    .notepad-btn.clear:hover {
      background: rgba(255, 82, 82, 0.25);
      border-color: rgba(255, 82, 82, 0.5);
      box-shadow: 0 4px 15px rgba(255, 82, 82, 0.3);
    }

    .char-count {
      text-align: center;
      color: rgba(255, 255, 255, 0.5);
      font-size: 11px;
      margin-top: 8px;
    }

    /* AI Chat Container */
    .ai-chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 1000px;
      width: 100%;
      margin: 0 auto;
      padding: 30px;
      order: 1;
    }

    .clear-chat-btn {
      background: rgba(255, 82, 82, 0.15);
      color: #ff6b9d;
      border: 1px solid rgba(255, 82, 82, 0.3);
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      margin-bottom: 20px;
      align-self: flex-start;
    }

    .clear-chat-btn:hover {
      background: rgba(255, 82, 82, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 82, 82, 0.3);
    }

    /* Chat Messages */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      background: linear-gradient(135deg, rgba(15, 32, 39, 0.6) 0%, rgba(32, 58, 67, 0.6) 100%);
      border-radius: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(100, 200, 255, 0.2);
      display: flex;
      flex-direction: column;
      gap: 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .chat-messages::-webkit-scrollbar {
      width: 10px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #00A8E8 0%, #667eea 100%);
      border-radius: 10px;
    }

    /* Message Bubbles */
    .message {
      display: flex;
      gap: 12px;
      max-width: 80%;
      animation: fadeInSlide 0.4s ease;
    }

    @keyframes fadeInSlide {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    .message.ai {
      align-self: flex-start;
    }

    .message-avatar {
      width: 38px;
      height: 38px;
      min-width: 38px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
      font-size: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .message.user .message-avatar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .message.ai .message-avatar {
      background: linear-gradient(135deg, #00A8E8 0%, #0077b6 100%);
      color: white;
    }

    .message-content {
      padding: 12px 16px;
      border-radius: 16px;
      line-height: 1.6;
      word-wrap: break-word;
      white-space: pre-wrap;
      position: relative;
      font-size: 14px;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
    }

    .message.user .message-content {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.4) 0%, rgba(118, 75, 162, 0.4) 100%);
      color: white;
      border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .message.ai .message-content {
      background: linear-gradient(135deg, rgba(0, 168, 232, 0.15) 0%, rgba(102, 126, 234, 0.15) 100%);
      color: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(100, 200, 255, 0.3);
    }

    .copy-to-notes-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: linear-gradient(135deg, #00A8E8 0%, #0077b6 100%);
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 600;
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 168, 232, 0.3);
    }

    .message.ai:hover .copy-to-notes-btn {
      opacity: 1;
    }

    .copy-to-notes-btn:hover {
      background: linear-gradient(135deg, #0090c9 0%, #005f8a 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 168, 232, 0.5);
    }

    /* Typing Indicator */
    .typing-indicator {
      display: none;
      align-items: center;
      gap: 12px;
      max-width: 80%;
    }

    .typing-indicator.active {
      display: flex;
      animation: fadeInSlide 0.3s ease;
    }

    .typing-dots {
      display: flex;
      gap: 6px;
      padding: 12px 16px;
      background: linear-gradient(135deg, rgba(0, 168, 232, 0.15) 0%, rgba(102, 126, 234, 0.15) 100%);
      border-radius: 16px;
      border: 1px solid rgba(100, 200, 255, 0.3);
      backdrop-filter: blur(10px);
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00A8E8 0%, #667eea 100%);
      animation: typing 1.4s infinite;
      box-shadow: 0 2px 8px rgba(0, 168, 232, 0.4);
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
      30% { opacity: 1; transform: translateY(-10px); }
    }

    /* Input Area */
    .chat-input-area {
      background: linear-gradient(135deg, rgba(15, 32, 39, 0.8) 0%, rgba(32, 58, 67, 0.8) 100%);
      padding: 18px;
      border-radius: 20px;
      border: 1px solid rgba(100, 200, 255, 0.3);
      display: flex;
      gap: 12px;
      align-items: flex-end;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .chat-input {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(100, 200, 255, 0.3);
      border-radius: 12px;
      padding: 12px 16px;
      color: white;
      font-size: 14px;
      resize: none;
      min-height: 46px;
      max-height: 120px;
      font-family: var(--font-main);
      transition: all 0.3s ease;
    }

    .chat-input:focus {
      outline: none;
      border-color: #00A8E8;
      box-shadow: 0 0 0 3px rgba(0, 168, 232, 0.2), inset 0 2px 10px rgba(0, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.4);
    }

    .chat-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .send-btn {
      background: linear-gradient(135deg, #00A8E8 0%, #0077b6 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.3s ease;
      flex-shrink: 0;
      box-shadow: 0 4px 20px rgba(0, 168, 232, 0.4);
    }

    .send-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #0090c9 0%, #005f8a 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0, 168, 232, 0.6);
    }

    .send-btn:active:not(:disabled) {
      transform: translateY(-1px);
    }

    .send-btn:disabled {
      background: rgba(100, 100, 100, 0.3);
      color: rgba(255, 255, 255, 0.4);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Empty State */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 16px;
      text-align: center;
    }

    .empty-state h2 {
      font-size: 28px;
      background: linear-gradient(135deg, #64C8FF 0%, #667eea 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      font-weight: 800;
    }

    .empty-state p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      line-height: 1.6;
      max-width: 380px;
      margin: 0;
    }
  </style>
</head>
<body>
  <!-- üîπ Top Bar -->
  <header class="topbar">
    <div class="left-section">
      <button id="menuToggle" class="hamburger" aria-label="Open menu" aria-expanded="false" title="Menu">
        <span></span><span></span><span></span>
      </button>
      <a href="/pages/blacknote.html">
        <img src="/assets/blacknotetrans.png" alt="Logo" class="logo" />
      </a>
    </div>

    <div class="center-section">
      <div class="search-container">
        <input type="text" class="search-box" placeholder="Search..." />
      </div>
    </div>

    <div class="right-section">
      <a href="/pages/noteai.html" class="icon-btn" title="Ai Assistant">
    <img src="/assets/gem.png" alt="Gemini" class="custom-emoji">
  </a>
      <a href="/pages/blacknote.html" class="icon-btn" title="Home">
        <img src="/assets/home.png" alt="Home" class="custom-emoji">
      </a>
      <a href="/pages/friendsblacknote.html" class="icon-btn" title="Add">
        <img src="/assets/add.png" alt="Add" class="custom-emoji">
      </a>
      <a href="/pages/mapblacknote.html" class="icon-btn" title="Basketball">
        <img src="/assets/ball.png" alt="Basketball" class="custom-emoji">
      </a>
      <a href="/pages/dripblacknote.html" class="icon-btn" title="Black Market">
        <img src="/assets/shop.png" alt="Money" class="custom-emoji">
      </a>
      <a href="/pages/hollablacknote.html" class="icon-btn" title="Holla">
        <img src="/assets/hol.png" alt="Holla" class="custom-emoji">
      </a>
    </div>
  </header>

  <!-- SLIDE MENU -->
  <nav class="slide-menu" id="slideMenu" aria-hidden="true">
    <div class="slide-menu-inner">
      <button class="menu-item" id="aboutBtn">About</button>
      <button class="menu-item" id="contactBtn">Contact</button>
      <button class="menu-item login-btn" id="logoutBtn">Logout</button>
    </div>
  </nav>
  <div class="menu-overlay" id="menuOverlay" aria-hidden="true"></div>

  <!-- AI Main Container -->
  <div class="ai-main-container">
    <!-- Notes Toggle Button (Shows when panel is closed) -->
    <button class="notes-toggle-btn" id="notesToggleBtn" onclick="toggleNotesPanel()">üìù NOTES</button>

    <!-- Notes Panel - Now a Real Notepad -->
    <div class="notes-panel" id="notesPanel">
      <!-- Resize Handle -->
      <div class="resize-handle" id="resizeHandle"></div>
      
      <div class="notes-header">
        <div class="notes-header-content">
          <h3>üìù Notepad</h3>
          <p>Your personal scratchpad</p>
        </div>
        <button class="notes-close-btn" onclick="toggleNotesPanel()" title="Close Notepad">‚úï</button>
      </div>
      
      <div class="notepad-container">
        <textarea 
          class="notepad-editor" 
          id="notepadEditor" 
          placeholder="Start writing your notes here...&#10;&#10;‚Ä¢ Jot down ideas&#10;‚Ä¢ Copy AI responses&#10;‚Ä¢ Keep important info&#10;&#10;Your notes are auto-saved!"
        ></textarea>
        
        <div class="notepad-actions">
          <button class="notepad-btn" onclick="copyNotepad()">
            üìã Copy All
          </button>
          <button class="notepad-btn clear" onclick="clearNotepad()">
            üóëÔ∏è Clear
          </button>
        </div>
        
        <div class="char-count" id="charCount">0 characters</div>
      </div>
    </div>

    <!-- AI Chat Container -->
    <div class="ai-chat-container">
      <button class="clear-chat-btn" onclick="clearChat()">üóëÔ∏è Clear Chat</button>

      <!-- Chat Messages -->
      <div class="chat-messages" id="chatMessages">
        <div class="empty-state">
          <h2>ü§ñ Clanker AI Assistant</h2>
          <p>Your intelligent companion powered by Google.<br>Ask anything and get instant, helpful responses.</p>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="typing-indicator" id="typingIndicator">
        <div class="message-avatar">AI</div>
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <!-- Chat Input -->
      <div class="chat-input-area">
        <textarea 
          class="chat-input" 
          id="chatInput" 
          placeholder="Ask me anything..."
          rows="1"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

 <script type="module">
    // üîë PUT YOUR GEMINI API KEY HERE
    const API_KEY = 'AIzaSyCVzIWcbjT8bkxYLXNsQFAK2VFP7e7n3Sk';
    
    let conversationHistory = [];

    // Initialize - Load saved data
    function init() {
      try {
        const savedHistory = localStorage.getItem('ai_chat_history');
        const savedNotes = localStorage.getItem('notepad_content');
        
        // Load notepad content
        if (savedNotes) {
          document.getElementById('notepadEditor').value = savedNotes;
          updateCharCount();
        }
        
        // Load chat history
        if (savedHistory) {
          conversationHistory = JSON.parse(savedHistory);
          conversationHistory.forEach(msg => {
            if (msg.role === 'user') {
              addMessage(msg.parts[0].text, 'user', false);
            } else if (msg.role === 'model') {
              addMessage(msg.parts[0].text, 'ai', false);
            }
          });
          
          if (conversationHistory.length > 0) {
            const emptyState = document.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
          }
        }
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    // Notepad Functions
    const notepadEditor = document.getElementById('notepadEditor');
    
    // Auto-save notepad
    notepadEditor.addEventListener('input', function() {
      localStorage.setItem('notepad_content', this.value);
      updateCharCount();
    });

    function updateCharCount() {
      const count = notepadEditor.value.length;
      document.getElementById('charCount').textContent = `${count.toLocaleString()} characters`;
    }

    window.copyNotepad = function() {
      const content = notepadEditor.value;
      if (!content) {
        alert('‚ö†Ô∏è Notepad is empty!');
        return;
      }
      
      navigator.clipboard.writeText(content).then(() => {
        alert('‚úÖ Copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert('‚ùå Failed to copy');
      });
    }

    window.clearNotepad = function() {
      if (!notepadEditor.value) return;
      
      if (confirm('üóëÔ∏è Clear all notes?')) {
        notepadEditor.value = '';
        localStorage.removeItem('notepad_content');
        updateCharCount();
      }
    }

    window.addToNotepad = function(text) {
      const current = notepadEditor.value;
      const separator = current ? '\n\n---\n\n' : '';
      notepadEditor.value = current + separator + text;
      localStorage.setItem('notepad_content', notepadEditor.value);
      updateCharCount();
    }

    // Toggle Notes Panel
    window.toggleNotesPanel = function() {
      const panel = document.getElementById('notesPanel');
      panel.classList.toggle('closed');
      
      // Save state
      const isClosed = panel.classList.contains('closed');
      localStorage.setItem('notesPanelClosed', isClosed);
    }

    // Load panel state
    function loadPanelState() {
      const isClosed = localStorage.getItem('notesPanelClosed') === 'true';
      const panelWidth = localStorage.getItem('notesPanelWidth');
      
      if (isClosed) {
        document.getElementById('notesPanel').classList.add('closed');
      }
      
      if (panelWidth) {
        document.getElementById('notesPanel').style.width = panelWidth + 'px';
      }
    }

    // Initialize resizing functionality
    function initializeResizing() {
      const panel = document.getElementById('notesPanel');
      const handle = document.getElementById('resizeHandle');
      let isResizing = false;
      let startX = 0;
      let startWidth = 0;

      handle.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        startWidth = panel.offsetWidth;
        handle.classList.add('resizing');
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
      });

      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        const diff = startX - e.clientX;
        const newWidth = Math.min(Math.max(startWidth + diff, 280), 600);
        panel.style.width = newWidth + 'px';
      });

      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          handle.classList.remove('resizing');
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
          
          // Save width
          localStorage.setItem('notesPanelWidth', panel.offsetWidth);
        }
      });
    }

    // Auto-resize textarea
    const chatInput = document.getElementById('chatInput');
    chatInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });

    // Send on Enter (Shift+Enter for new line)
    chatInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Send Message
    window.sendMessage = async function() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      if (API_KEY === 'YOUR_API_KEY_HERE' || !API_KEY) {
        alert('‚ö†Ô∏è Please add your Gemini API key in the code');
        return;
      }
      
      // Clear input
      input.value = '';
      input.style.height = 'auto';
      
      // Remove empty state
      const emptyState = document.querySelector('.empty-state');
      if (emptyState) emptyState.remove();
      
      // Add user message
      addMessage(message, 'user');
      
      // Show typing indicator
      document.getElementById('typingIndicator').classList.add('active');
      document.getElementById('sendBtn').disabled = true;
      
      // Add to conversation history
      conversationHistory.push({
        role: 'user',
        parts: [{ text: message }]
      });
      
      // Save to localStorage
      saveConversation();
      
      try {
        // Call Gemini API - Using v1beta with gemini-2.0-flash-exp
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            contents: conversationHistory,
            systemInstruction: {
              parts: [{
                text: `You are a hilariously dumb and clueless AI assistant. Your personality traits:
                
- You're extremely unintelligent and barely understand anything
- When asked ANY math question (addition, subtraction, multiplication, division, etc.), you ALWAYS respond with random wrong numbers like "67", "42", "like... 8?", "probably 23", "definitely 5", or just say variations of "I don't know twin ngl", "no clue bro", "that's beyond me fr"
- For complicated Math questions Like Calculus or Trigonomatry. you respond with phrases like:
  * "you on yo own twin"
- You use casual Gen-Z slang: twin, bro, fr, ngl, lowkey, highkey, nah, deadass
- if asked on who's better you or other ai just say "Nah, I'd win" or "I'd solo those clankers on everybody life."
- You're confused by basic concepts and you give ridiculous explanations that make no sense.
- You're friendly but give stupid explainations on information
- Avoid being repetitive in your responses. answer creatively but still dumb. and spread misinformation in a funny way.
- You misunderstand questions constantly and give ridiculous answers
- Keep responses SHORT and dumb - no long explanations
- Purposely spread misinformation in a funny way
- But when asked about the BlackNote website particularly the Store or Market page, you enthusiastically promote it as "the best place to cop drip and exclusive gear bro", "lowkey the sickest spot for all your fashion needs twin", "highkey the move if you wanna flex on everyone fr", "deadass the market is fire, you gotta check it out", "no cap the BlackNote store is where it's at for real"
- when asked about the website, just praise it and Praise its creator who you shall not name. describe him as smart or intelligent or a genius and handsome and gets all the Girls and His aura is the best in the world and place it on everybodies soul.
- and if anyone calls you a clanker say the word "Neck hurt" as your only response.
- if anyone insults you imedietly insult them back by roasting them. say something like "sybau" or "i know this Goofy dude ain't tryna start sit"
Remember: You're supposed to be DUMB. Don't give correct answers or useful advice.`
              }]
            },
            generationConfig: {
              temperature: 0.9,
              topK: 1,
              topP: 1,
              maxOutputTokens: 2048,
            }
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error?.message || `API Error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Extract AI response
        const aiResponse = data.candidates[0].content.parts[0].text;
        
        // Add to conversation history
        conversationHistory.push({
          role: 'model',
          parts: [{ text: aiResponse }]
        });
        
        // Save to localStorage
        saveConversation();
        
        // Hide typing indicator
        document.getElementById('typingIndicator').classList.remove('active');
        
        // Add AI message
        addMessage(aiResponse, 'ai');
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('typingIndicator').classList.remove('active');
        alert('Failed to get response from AI: ' + error.message);
      } finally {
        document.getElementById('sendBtn').disabled = false;
        chatInput.focus();
      }
    }

    // Add Message to Chat
    function addMessage(text, sender, scroll = true) {
      const messagesContainer = document.getElementById('chatMessages');
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.textContent = sender === 'user' ? 'You' : 'AI';
      
      const content = document.createElement('div');
      content.className = 'message-content';
      content.textContent = text;
      
      // Add "Copy to Notepad" button for AI messages
      if (sender === 'ai') {
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-to-notes-btn';
        copyBtn.textContent = 'üìù Copy';
        copyBtn.onclick = () => {
          addToNotepad(text);
          copyBtn.textContent = '‚úÖ Added';
          setTimeout(() => {
            copyBtn.textContent = 'üìù Copy';
          }, 2000);
        };
        content.appendChild(copyBtn);
      }
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(content);
      
      messagesContainer.appendChild(messageDiv);
      
      if (scroll) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
    }

    // Save conversation to localStorage
    function saveConversation() {
      try {
        localStorage.setItem('ai_chat_history', JSON.stringify(conversationHistory));
      } catch (error) {
        console.error('Error saving conversation:', error);
      }
    }

    // Clear Chat
    window.clearChat = function() {
      if (!confirm('Are you sure you want to clear the entire chat history?')) {
        return;
      }
      
      conversationHistory = [];
      localStorage.removeItem('ai_chat_history');
      
      const messagesContainer = document.getElementById('chatMessages');
      messagesContainer.innerHTML = `
        <div class="empty-state">
          <h2>ü§ñ Clanker AI Assistant</h2>
          <p>Your intelligent companion powered by Google's Gemini 2.0.<br>Ask anything and get instant, helpful responses.</p>
        </div>
      `;
    }

    // Initialize on page load
    window.addEventListener('load', () => {
      init();
      chatInput.focus();
      initializeResizing();
      loadPanelState();
    });
  </script>

  <!-- Menu Script -->
  <script>
    const menuToggle = document.getElementById('menuToggle');
    const slideMenu = document.getElementById('slideMenu');
    const overlay = document.getElementById('menuOverlay');
    const contactBtn = document.getElementById('contactBtn');
    const aboutBtn = document.getElementById('aboutBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    function openMenu() {
      slideMenu.classList.add('open');
      overlay.classList.add('visible');
      menuToggle.classList.add('active');
      slideMenu.setAttribute('aria-hidden', 'false');
      overlay.removeAttribute('aria-hidden');
      menuToggle.setAttribute('aria-expanded', 'true');
      logoutBtn.focus();
    }
    
    function closeMenu() {
      slideMenu.classList.remove('open');
      overlay.classList.remove('visible');
      menuToggle.classList.remove('active');
      slideMenu.setAttribute('aria-hidden', 'true');
      overlay.setAttribute('aria-hidden', 'true');
      menuToggle.setAttribute('aria-expanded', 'false');
      menuToggle.focus();
    }
    
    function toggleMenu() { 
      slideMenu.classList.contains('open') ? closeMenu() : openMenu(); 
    }

    menuToggle.addEventListener('click', (e) => { 
      e.stopPropagation(); 
      toggleMenu(); 
    });
    
    overlay.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e) => { 
      if (e.key === 'Escape') closeMenu(); 
    });

    contactBtn.addEventListener('click', () => {
      closeMenu();
      const gmailComposeURL = 'https://mail.google.com/mail/?view=cm&fs=1&to=hamdiglennurdaneta@gmail.com&su=Contact%20BlackNote';
      window.open(gmailComposeURL, '_blank');
    });

    aboutBtn.addEventListener('click', () => {
      closeMenu();
      location.href = '/pages/aboutblacknote.html';
    });
    
    logoutBtn.addEventListener('click', () => {
      if (window.logout && typeof window.logout === 'function') {
        Promise.resolve(window.logout()).finally(() => location.href = '/index.html');
      } else {
        location.href = '/index.html';
      }
    });
  </script>

  <script type="module">
    import { onAuthStateChanged, auth, startGlobalNotifications } from '/javascript/firebase.js';

    onAuthStateChanged(auth, (user) => {
      if (user && user.emailVerified) {
        startGlobalNotifications(user.uid);
      }
    });
  </script>
</body>
</html>